---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import Hero from '../components/Hero.astro';
import SectionHeader from '../components/SectionHeader.astro';
import PostCard from '../components/PostCard.astro';
import Footer from '../components/Footer.astro';

const pageTitle = 'Blog';

// Get all posts and sort them by date
const postFiles = import.meta.glob('./posts/*.md');
const posts = await Promise.all(
    Object.entries(postFiles).map(async ([path, resolver]) => {
        const post = await resolver() as any;
        const url = path.replace('./posts/', '/posts/').replace('.md', '');
        return { ...post, url };
    })
);

const sortedPosts = posts
    .filter((post: any) => post.frontmatter.title) // Filter out posts without titles
    .sort((a: any, b: any) => 
        new Date(b.frontmatter.pubDate).getTime() - new Date(a.frontmatter.pubDate).getTime()
    );
---

<Layout title={pageTitle}>
    <Navigation />
    
    <Hero 
        title="Writing & Thoughts" 
        description="Sharing my journey through tech, keyboards, and development."
    />

    <section class="posts">
        <SectionHeader 
            title="Latest Posts" 
            subtitle="My recent writings and musings"
        />

        <div class="posts-grid">
            {sortedPosts.map((post: any) => (
                <PostCard 
                    title={post.frontmatter.title}
                    description={post.frontmatter.description}
                    pubDate={post.frontmatter.pubDate}
                    url={post.url || `#`}
                    tags={post.frontmatter.tags}
                />
            ))}
        </div>
    </section>

    <Footer />
</Layout>

<style>
    .posts {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 2rem;
        margin-bottom: 4rem;
    }

    .posts-grid {
        display: flex;
        flex-direction: column;
        gap: 1px;
        background-color: var(--border);
        border-radius: 1rem;
        overflow: hidden;
    }

    @media (max-width: 768px) {
        .posts {
            padding: 0 1rem;
        }
    }
</style>